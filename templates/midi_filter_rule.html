<div id="midi_filter_rule_panel" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <h4 class="modal-title">Add new midi filter rule</h4>
    </div>
    <div class="modal-body">
      <select id="FILTER_ADD_COMMAND" name="FILTER_ADD_COMMAND" onchange="refreshSelectionView()">
        <option value="">Select a command</option>
        <option value="IGNORE">Ignore</option>
        <option value="MAP">Map</option>
      </select>

      <label for="FILTER_ADD_CHANNEL">for channels (no selection = all)</label>
      <select multiple name="FILTER_ADD_CHANNEL" onchange="refreshSelectionView()" size="5">
        {% for i in range(16) %}
        <option value="{{i+1}}">{{i+1}}</option>
        {% end %}
      </select>

      <label  for="FILTER_ADD_MIDI_EVENT">Midi Event</label>
      <select id="FILTER_ADD_MIDI_EVENT" multiple name="FILTER_ADD_MIDI_EVENT" onchange="refreshSelectionView()" size="5">

        {% for option in config['FILTER_ADD_MIDI_EVENT']['options'] %}
          <option value="{{ escape(option) }}">
            {% if 'option_labels' in config['FILTER_ADD_MIDI_EVENT'] %}
              {{ escape(config['FILTER_ADD_MIDI_EVENT']['option_labels'][option]) }}
            {% else %}
              {{ escape(option) }}
            {% end %}
          </option>
        {% end %}
      </select>


      <label id="FILTER_ADD_CC_VALUE_LABEL" for="FILTER_ADD_CC_VALUE">Midi CC Number</label>
      <select multiple id="FILTER_ADD_CC_VALUE" name="FILTER_ADD_CC_VALUE" onchange="" size="7">
        {% for i in range(32) %}
        <option value="{{i+1}}">
          {% if 'option_labels' in config['FILTER_ADD_CC_VALUE'] and str(i+1) in config['FILTER_ADD_CC_VALUE']['option_labels'] %}
            {{ escape(config['FILTER_ADD_CC_VALUE']['option_labels'][str(i+1)]) }}
          {% else %}
            {{ i+1 }}
          {% end %}
        </option>
        {% end %}
      </select>

      <label id="FILTER_ADD_MAPPED_MIDI_EVENT_LABEL" for="FILTER_ADD_MAPPED_MIDI_EVENT">Mapped Midi Event</label>
      <select id="FILTER_ADD_MAPPED_MIDI_EVENT" multiple name="FILTER_ADD_MAPPED_MIDI_EVENT" onchange="refreshSelectionView()" size="5">
        {% for option in config['FILTER_ADD_MAPPED_MIDI_EVENT']['options'] %}
          <option value="{{ escape(option) }}">
            {% if 'option_labels' in config['FILTER_ADD_MAPPED_MIDI_EVENT'] %}
              {{ escape(config['FILTER_ADD_MAPPED_MIDI_EVENT']['option_labels'][option]) }}
            {% else %}
              {{ escape(option) }}
            {% end %}
          </option>
        {% end %}
      </select>

      <label id="FILTER_ADD_MAPPED_CC_VALUE_LABEL" for="FILTER_ADD_MAPPED_CC_VALUE">Mapped Midi CC Number</label>
      <select   id="FILTER_ADD_MAPPED_CC_VALUE" name="FILTER_ADD_MAPPED_CC_VALUE" onchange="" size="7">
        {% for i in range(32) %}
        <option value="{{i+1}}">
          {% if 'option_labels' in config['FILTER_ADD_MAPPED_CC_VALUE'] and str(i+1) in config['FILTER_ADD_MAPPED_CC_VALUE']['option_labels'] %}
            {{ escape(config['FILTER_ADD_MAPPED_CC_VALUE']['option_labels'][str(i+1)]) }}
          {% else %}
            {{ i+1 }}
          {% end %}
        </option>
        {% end %}
      </select>
      <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal"><span aria-hidden="true">Add</span></button>
      </div>
    </div>
  </div>
</div>

<script>

$(document).ready(function() {
	$('#midi_filter_rule_add').click(function(){
		$('#midi_filter_rule_panel').show(500)
	});

	$('#midi_filter_rule_panel .close').click(function(){
		$('#midi_filter_rule_panel').hide(500)
	});

	window.onclick = function(event) {
		if (event.target == document.getElementById('midi_filter_rule_panel')) {
			$('#midi_filter_rule_panel').hide(500)
		}
	}

	commandSelect = document.getElementById('FILTER_ADD_COMMAND');
	midiEventSelect = document.getElementById('FILTER_ADD_MIDI_EVENT');

	mappedMidiEventSelect = document.getElementById('FILTER_ADD_MAPPED_MIDI_EVENT');
	mappedMidiEventSelectLabel = document.getElementById('FILTER_ADD_MAPPED_MIDI_EVENT_LABEL');

	ccValueSelect = document.getElementById('FILTER_ADD_CC_VALUE');
	ccValueSelectLabel = document.getElementById('FILTER_ADD_CC_VALUE_LABEL');

	mappedCCValueSelect = document.getElementById('FILTER_ADD_MAPPED_CC_VALUE');
	mappedCCValueSelectLabel = document.getElementById('FILTER_ADD_MAPPED_CC_VALUE_LABEL');
	
	refreshSelectionView();
});

function refreshSelectionView() {
	if ('CC' == midiEventSelect.value){
		ccValueSelect.style.display = "block";
		ccValueSelectLabel.style.display = "block";
	} else {
		ccValueSelect.style.display = "none";
		ccValueSelectLabel.style.display = "none";
		var elements = ccValueSelect.options;

		for(var i = 0; i < elements.length; i++){
			elements[i].selected = false;
		}
	}

	hideCCValue = true;
	if ('MAP' == commandSelect.value) {
		mappedMidiEventSelect.style.display = "block";
		mappedMidiEventSelectLabel.style.display = "block";
		if ('CC' == mappedMidiEventSelect.value){
			hideCCValue = false
		}
	} else {
		mappedMidiEventSelect.style.display = "none";
		mappedMidiEventSelectLabel.style.display = "none";
		var elements = mappedMidiEventSelect.options;
		for(var i = 0; i < elements.length; i++){
			elements[i].selected = false;
		}
	}
	if (hideCCValue) {
		mappedCCValueSelect.style.display = "none";
		mappedCCValueSelectLabel.style.display = "none";
		var elements = mappedCCValueSelect.options;
		for(var i = 0; i < elements.length; i++){
			elements[i].selected = false;
		}
	} else {
		mappedCCValueSelect.style.display = "block";
		mappedCCValueSelectLabel.style.display = "block";
	}
}

</script>
