
<h2>{{ escape(title) }}</h2>

<form id="ui-log-form" enctype="multipart/form-data" method="post">
	<div id="midi-log" class="log-panel"></div>
</form>

<div id="loading-div-background">
	<div id="loading-div" class="ui-corner-all">
		CONNECTING. PLEASE WAIT...
	</div>
</div>

<script type="text/javascript">

function show_logging() {
	var logDiv = $("#midi-log");

	logDiv.html('');
	var socketMessage = {"handler_name": "MidiLogMessageHandler",
		"data": 'SHOW_LOGGING'};
	window.zynthianSocket.send(JSON.stringify(socketMessage));
}

function showProgressAnimation(){
	$("#loading-div-background").show();
}

$(document).ready(function() {
	var deferred = $.Deferred();
	deferred.done(function(value) {
		window.zynthianSocket.registerHandler('MidiLogMessageHandler', function(data) {
			if (data) {
				console.log("MidiLogMessageHandler:onmessage:", data);
				var logDiv = $("#midi-log");
				dataPayload = "";
				if (data['type'] == 'note_on' || data['type'] == 'note_off') {
					dataPayload = ", Velocity:" + data['velocity'] + ", Note: " + data['note'];
				} else if (data['type'] == "pitchwheel") {
					dataPayload = ", Pitch: " + data['pitch'];
				} else if (data['type'] == "control_change") {
					dataPayload = ", Control: " + data['control'] + ", Value: " + data['value']
				}
				logDiv.append("Channel: " + data['channel'] + ", Type:" + data['type'] + ", Time: " + data['time'] +  dataPayload + "<br />");
				window.scrollTo(0,document.body.scrollHeight);
			}
		});
		var socketMessage = {"handler_name": "MidiLogMessageHandler", "data": 'SHOW_LOGGING'};
		window.zynthianSocket.send(JSON.stringify(socketMessage));
	});
	connectZynthianWebSocket(deferred);
});

</script>
